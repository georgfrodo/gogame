@page "/"
@using BeladaGameFrontend.Client.Components
@implements IAsyncDisposable
@inject HttpClient Http

<div class="container" style="max-height: 80%;">
    @if (!_passwordValidated)
    {
        <div class="center-content">
            <div class="card" style="max-width: 400px; width: 100%;">
                <div class="card-body">
                    <h3 class="card-title text-center">Enter Password</h3>
                    <div class="form-group mb-3">
                        <input type="password" class="form-control" @bind="Password" placeholder="Enter game password"/>
                    </div>
                    @if (!string.IsNullOrEmpty(_passwordError))
                    {
                        <div class="alert alert-danger" role="alert">
                            @_passwordError
                        </div>
                    }
                    <div class="d-flex justify-content-center">
                        <button class="btn btn-primary" @onclick="ValidatePassword" disabled="@_validatingPassword">
                            @if (_validatingPassword)
                            {
                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                <text> Validating...</text>
                            }
                            else
                            {
                                <text>Enter Game</text>
                            }
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
    else if (!_ingame)
    {
        <button class="btn btn-secondary position-absolute" style="top: 20px; left: 20px; z-index: 10;" @onclick="BackToPasswordScreen">← Back</button>
        
        <div class="center-content">
            <div class="card" style="max-width: 400px; width: 100%;">
                <div class="card-body">
                    <h3 class="card-title text-center">Join Game</h3>
                    
                    <div class="form-group mb-3">
                        <input type="text" class="form-control" @bind="Name" placeholder="Enter your name"/>
                    </div>
                    <div class="d-flex justify-content-center">
                        <button class="btn btn-primary" @onclick="EnterGame" disabled="@string.IsNullOrWhiteSpace(Name)">Enter Game</button>
                    </div>
                </div>
            </div>

            <h1 class="text-center mt-4" style="color: white;">Current players:</h1>
            <ul class="list-group" style="max-width: 400px; width: 100%;">
                @if (Players != null)
                {
                    foreach (var player in Players)
                    {
                        <li class="list-group-item" @onclick="@(()=>SetPlayer(player.Name))">@player.Name</li>
                    }
                }
            </ul>
        </div>
    }
    else
    {
        <GameComponent Player="_player"/>
        <div class="d-flex justify-content-center mt-3">
            <button class="btn btn-danger" @onclick="LeaveGame">Leave Game</button>
        </div>
    }
</div>